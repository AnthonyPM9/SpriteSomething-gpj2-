name: Test
description: Test app
inputs:
  os-name:
    required: true
    description: OS to run on

runs:
  using: "composite"
  steps:
  # checkout commit
  - name: Checkout commit
    uses: actions/checkout@v3

  # start virtual display driver & run tests
  - name: Start virtual display driver & Test (!Windows)
    shell: bash
    env:
      DISPLAY: :99
    run: |
      disp=:99
      screen=0
      geom=640x480x24
      exec Xvfb $disp -screen $screen $geom 2>/tmp/Xvfb.log &
      export DISPLAY=:99
      python -m ./tests/new/custom-tests.py
    if: contains(inputs.os-name, 'windows') != true
  - name: Start virtual display driver & Test (Windows)
    shell: bash
    uses: GabrielBB/xvfb-action@v1.4
    with:
      # run: python -m unittest
      run: python -m ./tests/new/custom-tests.py
    if: contains(inputs.os-name, 'windows')
